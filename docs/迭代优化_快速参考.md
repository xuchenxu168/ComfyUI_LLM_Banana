# [object Object]- 快速参考卡

## 📌 一句话说明
通过多轮对话逐步细化图像，每次运行节点时自动参考之前的对话历史。

---

## ⚙️ 参数设置

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `enable_iterative_refinement` | Boolean | False | 开启迭代优化 |
| `keep_last_turns` | Int (1-10) | 3 | 保留最近N轮对话 |
| `reset_conversation` | Boolean | False | 重置会话历史 |

---

## 🚀 快速开始

### 1️⃣ 开启功能
```
enable_iterative_refinement: ✅ True
keep_last_turns: 3
```

### 2️⃣ 多轮细化
```
第1轮: "A sunset over the ocean"
第2轮: "Add flying seagulls"
第3轮: "Make colors more vibrant"
```

### 3️⃣ 重置会话
```
reset_conversation: ✅ True
```

---

## 💡 最佳实践

### ✅ 推荐做法
- 配合固定 seed 使用（保持风格一致）
- 使用清晰的增量指令
- 保持 `keep_last_turns ≤ 5`
- 定期重置会话（长期项目）

### ❌ 避免做法
- 完全改变主题（会导致混乱）
- 设置过大的 `keep_last_turns`（增加成本）
- 在 IMAGE_ONLY 模式期待文本反馈

---

## 🔍 工作原理

```
[历史上下文]
- User: 第1轮提示词
- Assistant: 第1轮响应
- User: 第2轮提示词
- Assistant: 第2轮响应

[当前提示词]
```

模型会参考历史上下文，生成连贯的图像。

---

## 📁 会话存储

- **位置**：`ComfyUI_LLM_Banana/sessions/`
- **格式**：JSON 文件（按节点 unique_id 命名）
- **自动管理**：无需手动操作

---

## ⚠️ 注意事项

1. **Token 消耗**：历史越长，成本越高
2. **节点隔离**：每个节点的历史独立
3. **响应模式**：推荐使用 TEXT_AND_IMAGE

---

## 🆘 常见问题

### Q: 历史没有生效？
**A**: 检查 `enable_iterative_refinement` 是否为 True

### Q: 上下文混乱？
**A**: 设置 `reset_conversation: True` 重置

### Q: Token 消耗太大？
**A**: 减少 `keep_last_turns` 到 1-2

---

## 📚 完整文档
详见：[ITERATIVE_REFINEMENT_GUIDE.md](ITERATIVE_REFINEMENT_GUIDE.md)

---

**版本**：v1.0 | **更新**：2025-11-21

